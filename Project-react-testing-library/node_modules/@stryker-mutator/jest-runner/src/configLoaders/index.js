"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.configLoaderFactory = void 0;
const tslib_1 = require("tslib");
const plugin_1 = require("@stryker-mutator/api/plugin");
const pluginTokens_1 = require("../pluginTokens");
const CustomJestConfigLoader_1 = tslib_1.__importDefault(require("./CustomJestConfigLoader"));
const ReactScriptsJestConfigLoader_1 = tslib_1.__importDefault(require("./ReactScriptsJestConfigLoader"));
const ReactScriptsTSJestConfigLoader_1 = tslib_1.__importDefault(require("./ReactScriptsTSJestConfigLoader"));
configLoaderFactory.inject = plugin_1.tokens(plugin_1.commonTokens.options, plugin_1.commonTokens.injector, plugin_1.commonTokens.logger);
function configLoaderFactory(options, injector, log) {
    const warnAboutConfigFile = (projectType, configFile) => {
        if (configFile) {
            log.warn(`Config setting "configFile" is not supported for projectType "${projectType}"`);
        }
    };
    const optionsWithJest = options;
    const configLoaderInjector = injector
        .provideValue(pluginTokens_1.loaderToken, require)
        .provideValue(pluginTokens_1.resolveToken, require.resolve)
        .provideValue(pluginTokens_1.projectRootToken, process.cwd());
    switch (optionsWithJest.jest.projectType) {
        case 'custom':
            return configLoaderInjector.injectClass(CustomJestConfigLoader_1.default);
        case 'create-react-app':
            warnAboutConfigFile(optionsWithJest.jest.projectType, optionsWithJest.jest.configFile);
            return configLoaderInjector.injectClass(ReactScriptsJestConfigLoader_1.default);
        case 'create-react-app-ts':
            warnAboutConfigFile(optionsWithJest.jest.projectType, optionsWithJest.jest.configFile);
            return configLoaderInjector.injectClass(ReactScriptsTSJestConfigLoader_1.default);
        case 'react':
            log.warn('DEPRECATED: The projectType "react" is deprecated. Use projectType "create-react-app" for react projects created by "create-react-app" or use "custom" for other react projects.');
            warnAboutConfigFile(optionsWithJest.jest.projectType, optionsWithJest.jest.configFile);
            return configLoaderInjector.injectClass(ReactScriptsJestConfigLoader_1.default);
        case 'react-ts':
            log.warn('DEPRECATED: The projectType "react-ts" is deprecated. Use projectType "create-react-app-ts" for react projects created by "create-react-app" or use "custom" for other react projects.');
            warnAboutConfigFile(optionsWithJest.jest.projectType, optionsWithJest.jest.configFile);
            return configLoaderInjector.injectClass(ReactScriptsTSJestConfigLoader_1.default);
        default:
            throw new Error(`No configLoader available for ${optionsWithJest.jest.projectType}`);
    }
}
exports.configLoaderFactory = configLoaderFactory;
//# sourceMappingURL=index.js.map